<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>2048 게임</title>
  <style>
    body { font-family: Arial, sans-serif; background: #faf8ef; text-align: center; }
    h1 { color: #776e65; }
    #board { display: inline-block; background: #bbada0; padding: 10px; border-radius: 10px; }
    .row { display: flex; }
    .cell {
      width: 60px; height: 60px; margin: 5px;
      background: #cdc1b4; color: #776e65;
      font-size: 24px; font-weight: bold;
      display: flex; align-items: center; justify-content: center;
      border-radius: 5px;
      transition: background 0.2s;
    }
    .cell[data-value="2"]    { background: #eee4da; }
    .cell[data-value="4"]    { background: #ede0c8; }
    .cell[data-value="8"]    { background: #f2b179; color: #f9f6f2; }
    .cell[data-value="16"]   { background: #f59563; color: #f9f6f2; }
    .cell[data-value="32"]   { background: #f67c5f; color: #f9f6f2; }
    .cell[data-value="64"]   { background: #f65e3b; color: #f9f6f2; }
    .cell[data-value="128"]  { background: #edcf72; color: #f9f6f2; }
    .cell[data-value="256"]  { background: #edcc61; color: #f9f6f2; }
    .cell[data-value="512"]  { background: #edc850; color: #f9f6f2; }
    .cell[data-value="1024"] { background: #edc53f; color: #f9f6f2; }
    .cell[data-value="2048"] { background: #edc22e; color: #f9f6f2; }
    #score { margin: 10px; font-size: 20px; }
    #gameover { color: red; font-size: 24px; margin-top: 10px; }
    button { margin-top: 10px; padding: 8px 16px; font-size: 16px; }
  </style>
</head>
<body>
  <h1>2048 게임</h1>
  <div id="score">점수: 0</div>
  <div id="board"></div>
  <div id="gameover"></div>
  <button onclick="restart()">다시 시작</button>
  <script>
    const size = 4;
    let board, score, gameOver;

    function init() {
      board = Array.from({length: size}, () => Array(size).fill(0));
      score = 0;
      gameOver = false;
      addRandom();
      addRandom();
      draw();
      document.getElementById('gameover').textContent = '';
    }

    function addRandom() {
      let empty = [];
      for (let r = 0; r < size; r++)
        for (let c = 0; c < size; c++)
          if (board[r][c] === 0) empty.push([r, c]);
      if (empty.length === 0) return;
      let [r, c] = empty[Math.floor(Math.random() * empty.length)];
      board[r][c] = Math.random() < 0.9 ? 2 : 4;
    }

    function draw() {
      const boardDiv = document.getElementById('board');
      boardDiv.innerHTML = '';
      for (let r = 0; r < size; r++) {
        const rowDiv = document.createElement('div');
        rowDiv.className = 'row';
        for (let c = 0; c < size; c++) {
          const cellDiv = document.createElement('div');
          cellDiv.className = 'cell';
          cellDiv.dataset.value = board[r][c] || '';
          cellDiv.textContent = board[r][c] !== 0 ? board[r][c] : '';
          rowDiv.appendChild(cellDiv);
        }
        boardDiv.appendChild(rowDiv);
      }
      document.getElementById('score').textContent = '점수: ' + score;
    }

    function move(dir) {
      if (gameOver) return;
      let moved = false;
      let merged = Array.from({length: size}, () => Array(size).fill(false));
      let before = JSON.stringify(board);

      function traverse(callback) {
        for (let i = 0; i < size; i++)
          for (let j = 0; j < size; j++)
            callback(i, j);
      }

      function slide(r, c, dr, dc) {
        if (board[r][c] === 0) return false;
        let nr = r, nc = c;
        while (true) {
          let tr = nr + dr, tc = nc + dc;
          if (tr < 0 || tr >= size || tc < 0 || tc >= size) break;
          if (board[tr][tc] === 0) {
            board[tr][tc] = board[nr][nc];
            board[nr][nc] = 0;
            nr = tr; nc = tc;
            moved = true;
          } else if (board[tr][tc] === board[nr][nc] && !merged[tr][tc]) {
            board[tr][tc] *= 2;
            score += board[tr][tc];
            board[nr][nc] = 0;
            merged[tr][tc] = true;
            moved = true;
            break;
          } else break;
        }
      }

      if (dir === 'left') {
        for (let r = 0; r < size; r++)
          for (let c = 1; c < size; c++)
            slide(r, c, 0, -1);
      } else if (dir === 'right') {
        for (let r = 0; r < size; r++)
          for (let c = size - 2; c >= 0; c--)
            slide(r, c, 0, 1);
      } else if (dir === 'up') {
        for (let c = 0; c < size; c++)
          for (let r = 1; r < size; r++)
            slide(r, c, -1, 0);
      } else if (dir === 'down') {
        for (let c = 0; c < size; c++)
          for (let r = size - 2; r >= 0; r--)
            slide(r, c, 1, 0);
      }

      if (moved) {
        addRandom();
        draw();
        if (isGameOver()) {
          document.getElementById('gameover').textContent = '게임 오버!';
          gameOver = true;
        }
      }
    }

    function isGameOver() {
      for (let r = 0; r < size; r++)
        for (let c = 0; c < size; c++)
          if (board[r][c] === 0) return false;
      for (let r = 0; r < size; r++)
        for (let c = 0; c < size; c++) {
          if (r < size - 1 && board[r][c] === board[r+1][c]) return false;
          if (c < size - 1 && board[r][c] === board[r][c+1]) return false;
        }
      return true;
    }

    document.addEventListener('keydown', e => {
      if (e.key === 'ArrowLeft') move('left');
      else if (e.key === 'ArrowRight') move('right');
      else if (e.key === 'ArrowUp') move('up');
      else if (e.key === 'ArrowDown') move('down');
    });

    function restart() {
      init();
    }

    init();
  </script>
</body>
</html>
